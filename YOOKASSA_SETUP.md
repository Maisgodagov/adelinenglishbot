# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ –ÆKassa

–≠—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ÆKassa (—Ä–∞–Ω–µ–µ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å–∞) –≤ –≤–∞—à Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –∫—É—Ä—Å–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ß—Ç–æ —Ç–∞–∫–æ–µ –ÆKassa](#—á—Ç–æ-—Ç–∞–∫–æ–µ-—ékassa)
2. [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ](#—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–∏-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
3. [–ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π](#–ø–æ–ª—É—á–µ–Ω–∏–µ-api-–∫–ª—é—á–µ–π)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø—Ä–æ–µ–∫—Ç–∞)
5. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-webhook)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø–ª–∞—Ç–µ–∂–µ–π)
7. [–ó–∞–ø—É—Å–∫ –Ω–∞ production](#–∑–∞–ø—É—Å–∫-–Ω–∞-production)
8. [–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è](#—á–∞—Å—Ç—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã-–∏-—Ä–µ—à–µ–Ω–∏—è)
9. [–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏](#–ø–æ–ª–µ–∑–Ω—ã–µ-—Å—Å—ã–ª–∫–∏)

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ –ÆKassa

**–ÆKassa** ‚Äî —ç—Ç–æ –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã (Visa, Mastercard, –ú–ò–†)
- –ÆMoney (–±—ã–≤—à–∏–π –Ø–Ω–¥–µ–∫—Å.–î–µ–Ω—å–≥–∏)
- Qiwi
- –°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω
- Apple Pay / Google Pay
- –ò –¥—Ä—É–≥–∏–µ
  oiejriorjge

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ÆKassa:

‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã
‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è PCI DSS)
‚úÖ API –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ webhook –¥–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ö–æ–º–∏—Å—Å–∏—è:

- –û—Ç 2.8% –¥–æ 3.5% –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞—Ä–∏—Ñ–∞)
- –ù–µ—Ç –∞–±–æ–Ω–µ–Ω—Ç—Å–∫–æ–π –ø–ª–∞—Ç—ã

---

## –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç [–ÆKassa](https://yookassa.ru/)
2. –ù–∞–∂–º–∏—Ç–µ **"–ü–æ–¥–∫–ª—é—á–∏—Ç—å –ÆKassa"** –∏–ª–∏ **"–í–æ–π—Ç–∏"**
3. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å ID –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç

### –®–∞–≥ 2: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–ø–∞–Ω–∏–∏/–ò–ü

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:

**–î–ª—è –ò–ü:**

- –ò–ù–ù
- –û–ì–†–ù–ò–ü
- –†–µ–∫–≤–∏–∑–∏—Ç—ã —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ —Å—á–µ—Ç–∞
- –ö–æ–ø–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ò–ü
- –ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü:**

- –ò–ù–ù –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –û–ì–†–ù
- –†–µ–∫–≤–∏–∑–∏—Ç—ã —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ —Å—á–µ—Ç–∞
- –£—Å—Ç–∞–≤
- –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–î–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö:**

- –ò–ù–ù
- –°–ø—Ä–∞–≤–∫–∞ –æ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ —É—á–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–∞–º–æ–∑–∞–Ω—è—Ç–æ–≥–æ
- –†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–∞—Ä—Ç—ã –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤

### –®–∞–≥ 3: –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

1. –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É
2. –û–∂–∏–¥–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–æ–±—ã—á–Ω–æ 1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)
3. –ü–æ–ª—É—á–∏—Ç–µ email —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

> **–í–∞–∂–Ω–æ:** –î–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

### –®–∞–≥ 1: –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa](https://yookassa.ru/my)

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω

1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"** ‚Üí **"–ú–∞–≥–∞–∑–∏–Ω—ã"**
2. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω"**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–≥–∞–∑–∏–Ω–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: `English Course Bot`
   - –û–ø–∏—Å–∞–Ω–∏–µ: `Telegram –±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –∫—É—Ä—Å–æ–≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ`
   - –°–∞–π—Ç: URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –±–æ—Ç–∞
4. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

### –®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á–∏ API

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"** ‚Üí **"–î–∞–Ω–Ω—ã–µ –¥–ª—è API"**
3. –í—ã —É–≤–∏–¥–∏—Ç–µ:
   - **shopId** (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞) ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä: `123456`
   - **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** (secret key) ‚Äî –Ω–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á"** –∏–ª–∏ **"–ü–æ–∫–∞–∑–∞—Ç—å"**

**–ü—Ä–∏–º–µ—Ä:**

```
shopId: 123456
–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á: live_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

> ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –ù–∏–∫–æ–º—É –µ–≥–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ.

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏:

```
shopId: 123456 (–≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π shopId)
–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á: test_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

–¢–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `test_`, –±–æ–µ–≤—ã–µ —Å `live_`.

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É:

```bash
npm install
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç:

- `@a2seven/yoo-checkout` ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è SDK –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –ÆKassa
- `express` ‚Äî –¥–ª—è webhook-—Å–µ—Ä–≤–µ—Ä–∞
- `uuid` ‚Äî –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env`:

```bash
cp .env.example .env
```

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ÆKassa:

```bash
# –ÆKassa –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
YOOKASSA_SHOP_ID=123456
YOOKASSA_SECRET_KEY=live_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤ —Ä—É–±–ª—è—Ö
PAYMENT_AMOUNT=1000

# URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è webhook –∏ success URL)
SERVER_URL=https://yourdomain.com

# –ü–æ—Ä—Ç –¥–ª—è webhook —Å–µ—Ä–≤–µ—Ä–∞
WEBHOOK_PORT=3000
```

**–ì–¥–µ –≤–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ:**

- `YOOKASSA_SHOP_ID` ‚Äî ID –º–∞–≥–∞–∑–∏–Ω–∞ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ÆKassa
- `YOOKASSA_SECRET_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
- `PAYMENT_AMOUNT` ‚Äî —Ü–µ–Ω–∞ –∫—É—Ä—Å–∞ –≤ —Ä—É–±–ª—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000)
- `SERVER_URL` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://bot.example.com`)
- `WEBHOOK_PORT` ‚Äî –ø–æ—Ä—Ç –¥–ª—è webhook (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3000)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –∫–æ–¥–µ

–û—Ç–∫—Ä–æ–π—Ç–µ [src/bot.ts](src/bot.ts) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

```typescript
const yookassaShopId = process.env.YOOKASSA_SHOP_ID!;
const yookassaSecretKey = process.env.YOOKASSA_SECRET_KEY!;
const paymentAmount = process.env.PAYMENT_AMOUNT!;
const serverUrl = process.env.SERVER_URL!;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ÆKassa SDK
const checkout = new YooCheckout({
  shopId: yookassaShopId,
  secretKey: yookassaSecretKey,
});
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

Webhook –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –ÆKassa –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∞—à —Å–µ—Ä–≤–µ—Ä

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø–æ HTTPS (–ÆKassa —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è webhook).

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
npm install -g ngrok

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok –Ω–∞ –ø–æ—Ä—Ç—É 3000
ngrok http 3000
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ URL –≤–∏–¥–∞: `https://abc123.ngrok.io`

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa

1. –í–æ–π–¥–∏—Ç–µ –≤ [–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa](https://yookassa.ru/my)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"** ‚Üí **"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"** (–∏–ª–∏ **"HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"**)
4. –í–∫–ª—é—á–∏—Ç–µ **"HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"**
5. –£–∫–∞–∂–∏—Ç–µ URL webhook:

   ```
   https://yourdomain.com/webhook/yookassa
   ```

   –î–ª—è ngrok:

   ```
   https://abc123.ngrok.io/webhook/yookassa
   ```

6. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:

   - ‚úÖ `payment.succeeded` ‚Äî —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂
   - ‚úÖ `payment.canceled` ‚Äî –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - ‚úÖ `refund.succeeded` ‚Äî —É—Å–ø–µ—à–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

7. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç webhook –≤ –∫–æ–¥–µ

–í [src/bot.ts](src/bot.ts:405) webhook —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

```typescript
app.post("/webhook/yookassa", express.json(), async (req, res) => {
  try {
    console.log("–ü–æ–ª—É—á–µ–Ω webhook –æ—Ç –ÆKassa:", req.body);

    const notification = req.body;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
    if (notification.event === "payment.succeeded") {
      const payment = notification.object;
      const paymentId = payment.id;

      // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ paymentId –∏–ª–∏ metadata
      const chatId =
        paymentToChatId.get(paymentId) || parseInt(payment.metadata?.chatId);

      if (chatId) {
        // –í—ã–¥–∞—ë–º –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É
        await handleSuccessfulPayment(chatId);
        console.log(`‚úÖ –î–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${chatId}`);
      }
    }

    res.status(200).json({ success: true });
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook:", error);
    res.status(500).send("Internal Server Error");
  }
});
```

### –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –ÆKassa

–ÆKassa –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST-–∑–∞–ø—Ä–æ—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:

```json
{
  "type": "notification",
  "event": "payment.succeeded",
  "object": {
    "id": "2b5eda83-000f-5000-9000-1de77fa0d6df",
    "status": "succeeded",
    "amount": {
      "value": "1000.00",
      "currency": "RUB"
    },
    "description": "–ë—É–∫–≤–∞—Ä—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞",
    "metadata": {
      "chatId": "123456789"
    },
    "created_at": "2025-01-20T10:30:00.000Z",
    "paid": true
  }
}
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å ngrok

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ:

   ```bash
   npm run dev
   ```

2. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ ngrok:

   ```bash
   ngrok http 3000
   ```

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL –∏–∑ ngrok (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://abc123.ngrok.io`)

4. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:

   ```bash
   SERVER_URL=https://abc123.ngrok.io
   ```

5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ –ÆKassa –Ω–∞ URL:

   ```
   https://abc123.ngrok.io/webhook/yookassa
   ```

6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –ÆKassa

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `test_`).

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:**

| –ö–∞—Ä—Ç–∞                 | –†–µ–∑—É–ª—å—Ç–∞—Ç              |
| --------------------- | ---------------------- |
| `5555 5555 5555 4477` | –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞        |
| `5555 5555 5555 5599` | –û—Ç–∫–∞–∑ –≤ –æ–ø–ª–∞—Ç–µ         |
| `4111 1111 1111 1111` | –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ (Visa) |

- **CVC:** –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `123`)
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `12/25`)
- **–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞:** –ª—é–±–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TEST CARD`)

### –ü—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Å—å —Ñ–ª–æ—É –¥–æ –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –ÆKassa"**
4. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–ø–ª–∞—Ç—É
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - Webhook –ø—Ä–∏—à—ë–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏)
   - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∫—É—Ä—Å—É
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞ –æ—Ç–∫—Ä—ã–ª–∞—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
npm run dev

# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
# –ü–æ–ª—É—á–µ–Ω webhook –æ—Ç –ÆKassa: {...}
# ‚úÖ –î–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 123456789, –ø–ª–∞—Ç—ë–∂ 2b5eda83-000f-5000-9000-1de77fa0d6df
```

---

## –ó–∞–ø—É—Å–∫ –Ω–∞ production

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ production —Å–µ—Ä–≤–µ—Ä

–í–∞–º –Ω—É–∂–µ–Ω VPS —Å:

- Node.js 18+
- HTTPS (SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
- –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ö–æ—Å—Ç–∏–Ω–≥–∏:**

- [Timeweb](https://timeweb.com/) ‚Äî –æ—Ç 200‚ÇΩ/–º–µ—Å—è—Ü
- [Beget](https://beget.com/) ‚Äî –æ—Ç 150‚ÇΩ/–º–µ—Å—è—Ü
- [REG.RU](https://www.reg.ru/) ‚Äî –æ—Ç 200‚ÇΩ/–º–µ—Å—è—Ü

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ nginx + Let's Encrypt:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nginx
sudo apt install nginx

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ certbot –¥–ª—è SSL
sudo apt install certbot python3-certbot-nginx

# –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d yourdomain.com
```

**–ù–∞—Å—Ç—Ä–æ–π—Ç–µ nginx –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç 3000:**

```nginx
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx:

```bash
sudo systemctl restart nginx
```

### –®–∞–≥ 3: –î–µ–ø–ª–æ–π –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ [DEPLOY.md](DEPLOY.md)

–ö—Ä–∞—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd english-bot

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm ci --only=production

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Å –±–æ–µ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏
nano .env

# –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run build

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å PM2
pm2 start dist/bot.js --name english-bot
pm2 save
pm2 startup
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –±–æ–µ–≤—ã–µ –∫–ª—é—á–∏

–û–±–Ω–æ–≤–∏—Ç–µ `.env` –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ live_ –∫–ª—é—á –≤–º–µ—Å—Ç–æ test_
YOOKASSA_SECRET_KEY=live_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# –£–∫–∞–∂–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞
SERVER_URL=https://yourdomain.com
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

```bash
pm2 restart english-bot
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç–µ webhook –≤ –ÆKassa

1. –í–æ–π–¥–∏—Ç–µ –≤ [–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa](https://yookassa.ru/my)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞
3. –û–±–Ω–æ–≤–∏—Ç–µ URL webhook –Ω–∞ production:
   ```
   https://yourdomain.com/webhook/yookassa
   ```
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –®–∞–≥ 6: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ production

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –ü—Ä–æ–π–¥–∏—Ç–µ —Ñ–ª–æ—É –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π –ø–ª–∞—Ç—ë–∂ (–º–æ–∂–Ω–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –ï—Å–ª–∏ –≤—Å—ë –û–ö ‚Äî –≤–µ—Ä–Ω–∏—Ç–µ –Ω—É–∂–Ω—É—é —Å—É–º–º—É –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa

---

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞**

   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS
   - –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://yourdomain.com/webhook/yookassa`
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Cannot GET /webhook/yookassa` –∏–ª–∏ `404` (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, GET –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω URL –≤ –ÆKassa**

   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: `https://yourdomain.com/webhook/yookassa` (–±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)

3. **–°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω**

   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
   pm2 status
   pm2 logs english-bot
   ```

4. **Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã**
   ```bash
   # –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã 80 –∏ 443
   sudo ufw allow 80
   sudo ufw allow 443
   ```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook –≤—Ä—É—á–Ω—É—é:**

```bash
curl -X POST https://yourdomain.com/webhook/yookassa \
  -H "Content-Type: application/json" \
  -d '{
    "type": "notification",
    "event": "payment.succeeded",
    "object": {
      "id": "test-payment-id",
      "status": "succeeded",
      "metadata": {
        "chatId": "123456789"
      }
    }
  }'
```

### ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. **Webhook –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä**

   ```bash
   pm2 logs english-bot
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "–ü–æ–ª—É—á–µ–Ω webhook –æ—Ç –ÆKassa: {...}"
   ```

2. **chatId –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è**

   - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ chatId –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `metadata`
   - –ü—Ä–∏ webhook chatId –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ `payment.metadata.chatId`

3. **–§—É–Ω–∫—Ü–∏—è `handleSuccessfulPayment` —Ä–∞–±–æ—Ç–∞–µ—Ç**
   ```typescript
   async function handleSuccessfulPayment(chatId: number) {
     await bot.sendMessage(chatId, "‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!");
     // ... –≤—ã–¥–∞—á–∞ –¥–æ—Å—Ç—É–ø–∞
   }
   ```

### ‚ùå –û—à–∏–±–∫–∞: "Invalid shopId or secretKey"

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–ª—é—á–∏ –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
3. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_` –∫–ª—é—á, –¥–ª—è production ‚Äî `live_`

### ‚ùå –û—à–∏–±–∫–∞: "SSL certificate problem"

**–†–µ—à–µ–Ω–∏–µ:**

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–µ–π—Å—Ç–≤—É—é—â–∏–π SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certificates

# –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot renew
```

### ‚ùå –ü–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–µ–Ω, –Ω–æ –±–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫:

   ```bash
   pm2 logs english-bot --lines 100
   ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook endpoint –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç event:

   ```typescript
   if (notification.event === "payment.succeeded") {
     // –í–∞—à –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   }
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `chatId` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è:
   ```typescript
   const chatId =
     paymentToChatId.get(paymentId) || parseInt(payment.metadata?.chatId);
   ```

### ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç `/payment/success` –≤ [src/bot.ts](src/bot.ts:446):

   ```typescript
   app.get("/payment/success", (req, res) => {
     res.send(`<!DOCTYPE html>...`);
   });
   ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `return_url` –≤ –ø–ª–∞—Ç–µ–∂–µ —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
   ```typescript
   confirmation: {
     type: 'redirect',
     return_url: `${serverUrl}/payment/success`
   }
   ```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ÆKassa

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API](https://yookassa.ru/developers/api)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±—ã—Å—Ç—Ä–æ–º—É —Å—Ç–∞—Ä—Ç—É](https://yookassa.ru/developers/using-api/basics)
- [–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Webhook)](https://yookassa.ru/developers/using-api/webhooks)
- [–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ](https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing)
- [–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç](https://yookassa.ru/my)

### SDK –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- [@a2seven/yoo-checkout](https://github.com/AlexeyKosinski/yookassa-sdk-nodejs) ‚Äî Node.js SDK (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ)
- [npm package](https://www.npmjs.com/package/@a2seven/yoo-checkout)

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- [–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ÆKassa](https://yookassa.ru/help)
- –¢–µ–ª–µ—Ñ–æ–Ω: 8 800 250-66-99 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ –†–æ—Å—Å–∏–∏)
- Email: support@yookassa.ru

### –î–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞

- [README.md](README.md) ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ
- [DEPLOY.md](DEPLOY.md) ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [UPDATE.md](UPDATE.md) ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –±–æ—Ç–∞

---

## –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–∞ production —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –ü—Ä–æ–π–¥–µ–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—è –≤ –ÆKassa
- [ ] –ü–æ–ª—É—á–µ–Ω—ã –±–æ–µ–≤—ã–µ API –∫–ª—é—á–∏ (`live_`)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω `.env` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
- [ ] –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω webhook –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Ñ–ª–æ—É –æ–ø–ª–∞—Ç—ã (—Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏)
- [ ] Webhook –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞ (PM2, –ª–æ–≥–∏)
- [ ] –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –≤–∞—à –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –ÆKassa! üéâ

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª [–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#—á–∞—Å—Ç—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã-–∏-—Ä–µ—à–µ–Ω–∏—è)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `pm2 logs english-bot`
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ÆKassa: support@yookassa.ru

–£—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂! üí∞
